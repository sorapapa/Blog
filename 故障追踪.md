#故障追踪

##故障追踪 案例 套路分析

业务线很难自己定位清楚一个复杂故障，
业务方有时甚至无法描述清楚故障，无法提炼出需求。

故障追踪未必要等到故障真的出现，也可以预防故障发生

1.首先要求业务方故障自查。（有无发版，应用日志是否正常，中间件调用是否正常 接口调用是否正常）
2.故障类型 （硬件故障 应用故障 网络故障 系统故障 ）
故障层级（底层：硬件 网络 中层：系统 应用 高层：负载 cdn 调用：中间件 数据库 接口 ）
故障假设（我怀疑nginx 或者CDN有问题）
判断逻辑	 (我的源站是正常的，但是用户请求是5xx)
发起故障定位的两种原因，一，已确定具体故障，寻求后续解决方案。二，未确定具体故障，寻求定位故障原因。
3.故障追踪的结果，1，准确定位到故障 2无法定位到故障 

案例2
现象，双实例容器cpu忽高忽低，加了一倍实例问题仍存在，
排查流程
查阅之家云发版日志和监控发现
发版两天后一直正常，第三天出现故障，运维排查推测程序进程自身占用cpu过高导致。与开发声称程序没问题不符。要求业务回退版本后得知程序已被三方调用“不能回退”
此时业务又提出假设，从应用日志中推测出epoll空轮休bug或kafka问题。（如何论证这个假设？）
运维要求业务内部沟通回退版本快速排障，详细日志发给运维

复盘
按要求填写了故障追踪，但依然存在某些信息不对等。


业务提工单时没有明确表达曾怀疑epool空轮训或 kafka问题，给出的堆栈日志运维看不懂，也没有阐述故障假设的判断逻辑和论点论据。

我不懂如何确认epool kafka 有没有问题，

如果假设是程序出现问题，业务因为已产生原因又不能会退代码怎么办？
不能回退某种程度上是借口或真的害怕引发更大故障，或该故障仍在容忍范围之内。找借口是因为不想付出个人时间成本。害怕故障因为没有做好充分准备工作。

故障等级高中低
故障范围大中小

我思考问题 分析案例 算不算kpi 如何考核
案例
我在不在思考外界不可观测和统计，我思考的结果，短时间内微不足道，甚至可能是错的需要反复摸索实践打磨验证才能形成系统的理论。如何让思想变得可以考核可以衡量？
如何铸就运维宝典？

以故障追踪为切入点去了解中间件的话可以先了解如何判断中间件目前是否正常，简单故障有哪些，简单故障如何处理。

切入点，我需要一条主线任务，目前来看是故障追踪与定位，分支任务是熟悉中间件，目标是一年熟悉中间件mq redis es ，产出故障处理流程和工具化的理论依据和落地方案。

不耻下问的套路？
不要自以为是 多听少说 提炼问题

有时候业务既想让运维配合排查问题，但又不想运维查的太透彻，害怕运维找到的故障的根因是业务导致的

后续思路
先收集故障追踪样本，
再绘制故障追踪的流程
根据不同故障类型添加流程的分支
不断完善故障分支和解决方案。
先手动试运行一段时间。
尝试工具化平台花解决方案。
不断完善和打磨


案例3
工单内容
pv.alert.autohome.com.cn
这个域名不能访问了 请帮忙排查下什么原因

运维排查流程
pv.alert.autohome.com.cn 请求出现404
询问业务是否自检源站，
同时查看域名LB配置 
1.LB配置修改日期为21年1月 近期无修改
2.得到业务反馈不知道该域名源站多少（贴配置给业务）
3.用ELK查找nginx日志，结果没有查到。。。
4.手动查看廊坊-大数据-外网集群是否有日志，发现日志本地记录正常。
5.tail -f /data/nginx/logs/al.autohome.com.cn_access.log |grep pv.alert.autohome.com.cn
6.查阅日志发现upstream_status 404
7反馈业务查询应用日志 故障假设（应用异常 调用异常：建议查看数据库 中间件 接口 程序自身）



案例3
工单内容
pv.alert.autohome.com.cn
这个域名不能访问了 请帮忙排查下什么原因

运维排查流程
pv.alert.autohome.com.cn 请求出现404
询问业务是否自检源站，
同时查看域名LB配置 
1.LB配置修改日期为21年1月 近期无修改
2.得到业务反馈不知道该域名源站多少（贴配置给业务）
3.用ELK查找nginx日志，结果没有查到。。。
4.手动查看廊坊-大数据-外网集群是否有日志，发现日志本地记录正常。
5.tail -f /data/nginx/logs/al.autohome.com.cn_access.log |grep pv.alert.autohome.com.cn
6.查阅日志发现upstream_status 404
7反馈业务查询应用日志 故障假设（应用异常 调用异常：建议查看数据库 中间件 接口 程序自身）



1）海外源站负载突增系统日志分析，监控显示5：40CPU开始升高，网络流量5：40-5：44翻倍，流量从4M徒增至8M，业务反馈应用日志正常，且近期无发版，运维协助排查系统日志，未发现异常，后续和业务观察中，


2）海外站经销商数据库响应过慢，根本原因是读写域名同时指向写库导致


案例4

工单内容
1、背景介绍
之家云应用ID：9923    
之家云服务名称：ad-activity-deliver   
故障类型：CPU利用率超100%  
是否恢复：已恢复  
故障时间：2021-07-07 17:35

2、故障现象：
已申请2台实例，cpu利用率在某个时间段还是会超100%。
今天频繁出现利用率超100%，但是很快恢复。

3、影响范围
无

4、帮忙协助定位问题
运维排查流程
1.询问开发近期是否发版是否回退版本尝试恢复，
2.业务反馈：已自检查，近期发过版，但是未发现问题，就改了版本号没有回退过都是小改动，加版本号或者加个简单的校验，可能是kafka调用NIO的selector空轮询导致的
3.运维检查之家云发版日志和监控发现发版两天后一直正常，第三天出现故障，
4.运维排查确认程序进程自身占用cpu过高导致。与开发声称程序没问题不符。要求业务回退版本后得知 不能回退，有些关联功能已经上线了
5.业务询问就算是我们项目占用率高，如果我们不知道问题出在哪，运维是否负责处理
6.运维表示超出能力范围，代码层面
运维要求业务内部沟通回退版本快速排障，详细日志发给运维

